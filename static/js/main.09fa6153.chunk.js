(this["webpackJsonpozitag-test"]=this["webpackJsonpozitag-test"]||[]).push([[0],{11:function(e,t,n){"use strict";var r=n(3),a=n.n(r),o=n(7),s=n(22),c=n(23),i=function(){function e(){Object(s.a)(this,e),this.token=null,this.expiresAt=null,this.refreshToken=null,this.tokenType=null;try{var t=JSON.parse(localStorage.getItem("ozitag-user"));t.expiresAt&&new Date(t.expiresAt)>new Date&&(this.token=t.token,this.expiresAt=t.expiresAt,this.refreshToken=t.refreshToken,this.tokenType=t.tokenType)}catch(n){}}return Object(c.a)(e,[{key:"_fetch",value:function(){var e=Object(o.a)(a.a.mark((function e(t,n,r,o){var s,c,i,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("https://tager.dev.ozitag.com/api/").concat(n),{method:t,headers:{"Content-Type":"application/json",Authorization:this.token?"".concat(this.tokenType," ").concat(this.token):void 0,"Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Access-Control-Allow-Methods":"GET,HEAD,OPTIONS,POST,PUT","Access-Control-Allow-Headers":"Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method, Access-Control-Request-Headers"},body:r?JSON.stringify(r):void 0});case 2:return s=e.sent,e.prev=3,e.next=6,s.json();case 6:c=e.sent,e.next=11;break;case 9:e.prev=9,e.t0=e.catch(3);case 11:if(s.ok){e.next=17;break}if(!o||401!==s.status){e.next=16;break}return e.next=15,this._getAccessToken();case 15:return e.abrupt("return",this._fetch(t,n,r));case 16:throw new Error(null!==(i=null===(u=c)||void 0===u?void 0:u.message)&&void 0!==i?i:"Something went wrong");case 17:return e.abrupt("return",c.data);case 18:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"isLoggedIn",value:function(){return!!this.token&&new Date(this.expiresAt)>new Date}},{key:"login",value:function(){var e=Object(o.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetch("POST","auth/user",{email:t,password:n,clientId:1});case 2:r=e.sent,this.token=r.accessToken,this.expiresAt=r.expiresAt,this.refreshToken=r.refreshToken,this.tokenType=r.tokenType,localStorage.setItem("ozitag-user",JSON.stringify({token:r.accessToken,expiresAt:r.expiresAt,refreshToken:r.refreshToken,tokenType:r.tokenType}));case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetch("POST","user/profile/logout");case 2:this.token=null,this.expiresAt=null,this.refreshToken=null,this.tokenType=null,localStorage.removeItem("ozitag-user");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getAccessToken",value:function(){var e=Object(o.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetch("POST","user/profile/token",{refreshToken:this.refreshToken});case 2:t=e.sent,this.token=t.accessToken,this.expiresAt=t.expiresAt,localStorage.setItem("ozitag-user",JSON.stringify({token:t.accessToken,expiresAt:t.expiresAt,refreshToken:this.refreshToken}));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getProfileInfo",value:function(){return this._fetch("GET","user/profile",null,!0)}}]),e}();t.a=new i},24:function(e,t,n){e.exports={button:"ExitButton_button__2SJm_"}},25:function(e,t,n){e.exports={header:"Header_header__3dtee"}},27:function(e,t,n){e.exports=n(38)},37:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(21),s=n.n(o),c=n(13),i=n(9),u=n(1),l=Object(r.lazy)((function(){return Promise.all([n.e(2),n.e(4)]).then(n.bind(null,101))})),h=Object(r.lazy)((function(){return n.e(5).then(n.bind(null,102))})),p=function(e){var t=e.loggedIn;return a.a.createElement(r.Suspense,{key:t,fallback:a.a.createElement("div",null,"Loading...")},a.a.createElement(u.d,null,!t&&a.a.createElement(a.a.Fragment,null,a.a.createElement(u.b,{path:"/login",exact:!0,component:l}),a.a.createElement(u.a,{to:"/login"})),t&&a.a.createElement(a.a.Fragment,null,a.a.createElement(u.b,{path:"/",exact:!0,component:h}),a.a.createElement(u.a,{to:"/"}))))},f=n(17),k=n(24),m=n.n(k),g=Object(r.memo)((function(e){var t=e.name,n=Object(f.a)(e,["name"]);return a.a.createElement("button",Object.assign({className:m.a.button},n),t)})),d=n(25),v=n.n(d),b=function(){var e=Object(r.useContext)(i.a).logout;return a.a.createElement("div",{className:v.a.header},a.a.createElement(g,{onClick:e,name:"Logout"}))},x=function(){var e=Object(r.useContext)(i.a).loggedIn;return a.a.createElement("div",{className:"container"},e&&a.a.createElement(b,null),a.a.createElement(p,{loggedIn:e}))};n(37);s.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(c.a,null,a.a.createElement(i.b,null,a.a.createElement(x,null)))),document.getElementById("root"))},9:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return h}));var r=n(3),a=n.n(r),o=n(7),s=n(16),c=n(0),i=n.n(c),u=n(11),l=Object(c.createContext)(),h=(l.Consumer,function(e){var t=e.children,n=Object(c.useState)((function(){return u.a.isLoggedIn()})),r=Object(s.a)(n,2),h=r[0],p=r[1],f=Object(c.useCallback)(function(){var e=Object(o.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.login(t,n);case 2:p(!0);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[]),k=Object(c.useCallback)(Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.a.logout();case 2:p(!1);case 3:case"end":return e.stop()}}),e)}))),[]),m=Object(c.useMemo)((function(){return{login:f,logout:k,loggedIn:h}}),[h]);return i.a.createElement(l.Provider,{value:m},t)})}},[[27,1,3]]]);
//# sourceMappingURL=main.09fa6153.chunk.js.map